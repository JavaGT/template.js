var y=/{{(?![\S]*?:)\s*([\s\S]*?)\s*}}/g;var v=/{{for:\s*([\s\S]*?)\s*([\s\S]*?)\s*}}([\s\S]*?){{\/for:\s*\1\s*}}/g;var b=/{{if:\s*([\s\S]*?)\s*([\s\S]*?)\s*?}}([\s\S]*?)(?={{)(?:{{else:\s*\1\s*}})?([\s\S]*?){{\/if:\s*\1\s*}}/g;var d=(s,o)=>{s=s.split('.');while(o&&s[0]&&(o=o[s.shift()]));return o};var z={'&&':(a,b)=>e(a)&&e(b),'||':(a,b)=>e(a)||e(b),'===':(a,b)=>e(a)===e(b),'!==':(a,b)=>e(a)!==e(b),'<=':(a,b)=>e(a)<=e(b),'>=':(a,b)=>e(a)>=e(b),'<':(a,b)=>e(a)<e(b),'>':(a,b)=>e(a)>e(b),'==':(a,b)=>e(a)==e(b),'!=':(a,b)=>e(a)!=e(b),'+':(a,b)=>e(a)+e(b),'-':(a,b)=>e(a)-e(b),'%':(a,b)=>e(a)%e(b),'*':(a,b)=>e(a)*e(b),'/':(a,b)=>e(a)/e(b)},symbolKeys=Object.keys(z);function e(s,o){s=s.replace(/^\s+|\s+$/g,'');if(s.charAt(0)=='!')return !e(s.substr(1),o);if(s==='true')return true;if(s==='false')return false;s=s.replace(/\(([\s\S]*)\)/g,(a,s)=>e(s,o));for(var i=0;i<symbolKeys.length;i++){if((split=s.split(symbolKeys[i])).length>1){return z[symbolKeys[i]](split[0],split[1])}}return d(s,o)||(isNaN(Number(s))?s:Number(s))}
module.exports=function r(s,o){s=s.replace(y,(a,b)=>d(b,o));var m;while((m=v.exec(s))!==null){if(m.index===v.lastIndex){v.lastIndex++}if(m){var t='';d(m[2],o).forEach(subdata=>{t+=r(m[3].replace(RegExp('{{'+m[1]+':\\s*([\\s\\S]*?)\\s*}}','g'),(a,s)=>d(s,subdata)),o)});s=s.replace(m[0],t)}}return s.replace(b,(a,s,d,f,g)=>r((e(d,o)?f:g),o))}
